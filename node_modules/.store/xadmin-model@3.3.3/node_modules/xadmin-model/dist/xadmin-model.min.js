!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("xadmin-ui"),require("lodash"),require("xadmin"),require("react-router-dom"),require("recoil"),require("xadmin-i18n"),require("moment"),require("xadmin-form")):"function"==typeof define&&define.amd?define(["exports","react","xadmin-ui","lodash","xadmin","react-router-dom","recoil","xadmin-i18n","moment","xadmin-form"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).xadminModel={},e.React,e.xadminUi,e._,e.xadmin,e.ReactRouterDOM,e.Recoil,e.xadminI18n,e.moment,e.xadminForm)}(this,(function(e,t,r,n,o,a,i,l,u,c){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d=s(t),f=s(n),m=s(o),p=s(u);function v(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function h(e,t){return e(t={exports:{}},t.exports),t.exports}var y=v(h((function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},e.exports.default=e.exports,e.exports.__esModule=!0,t.apply(this,arguments)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}))),g=h((function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);t>r;r++)n[r]=e[r];return n},e.exports.default=e.exports,e.exports.__esModule=!0}));v(g);var b=h((function(e){e.exports=function(e){if(Array.isArray(e))return g(e)},e.exports.default=e.exports,e.exports.__esModule=!0}));v(b);var O=h((function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0}));v(O);var x=h((function(e){e.exports=function(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0}));v(x);var w=h((function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}));v(w);var j=v(h((function(e){e.exports=function(e){return b(e)||O(e)||x(e)||w()},e.exports.default=e.exports,e.exports.__esModule=!0}))),E=h((function(e){e.exports=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;a.length>n;n++)0>t.indexOf(r=a[n])&&(o[r]=e[r]);return o},e.exports.default=e.exports,e.exports.__esModule=!0}));v(E);var k=v(h((function(e){e.exports=function(e,t){if(null==e)return{};var r,n,o=E(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;a.length>n;n++)0>t.indexOf(r=a[n])&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o},e.exports.default=e.exports,e.exports.__esModule=!0}))),P=h((function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.default=e.exports,e.exports.__esModule=!0}));v(P);var S=h((function(e){e.exports=function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=r){var n,o,a=[],i=!0,l=!1;try{for(r=r.call(e);!(i=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==r.return||r.return()}finally{if(l)throw o}}return a}},e.exports.default=e.exports,e.exports.__esModule=!0}));v(S);var M=h((function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}));v(M);var L=v(h((function(e){e.exports=function(e,t){return P(e)||S(e,t)||x(e,t)||M()},e.exports.default=e.exports,e.exports.__esModule=!0}))),F=v(h((function(e){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0})));function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var D=function(e,t){var r=i.atom({key:e("ids"),default:[]}),n=i.atomFamily({key:e("item"),default:{}}),o=i.selector({key:e("items"),get:function(e){var t=e.get;return t(r).map((function(e){return t(n(e))})).filter((function(e){return!f.default.isNil(e)}))},set:function(e,t){var o=e.set,a=t.map((function(e){return f.default.isNil(e.id)?null:(o(n(e.id),e),e.id)})).filter(Boolean);o(r,a)}}),a=i.atom({key:e("count"),default:0}),l=i.atom({key:e("selected"),default:[]}),u=i.atom({key:e("option"),default:{}}),c=function(t){return i.selector({key:e(t),get:function(e){return(0,e.get)(u)[t]},set:function(e,r){(0,e.set)(u,A(A({},(0,e.get)(u)),{},F({},t,r)))}})},s=c("fields"),d=c("order"),m=c("limit"),p=c("skip"),v=i.atom({key:e("wheres"),default:{}}),h=i.selectorFamily({key:e("where"),get:function(e){return function(t){return(0,t.get)(v)[e]}},set:function(e){return function(t,r){var n=t.set;n(v,A(A({},f.default.omit((0,t.get)(v),e)),f.default.isEmpty(r)?{}:F({},e,r))),n(p,0)}}}),y=i.atomFamily({key:e("loading"),default:!1}),g=i.selectorFamily({key:e("itemSelected"),get:function(e){return function(t){return void 0!==(0,t.get)(l).find((function(t){return t.id==e}))}},set:function(e){return function(t,r){var o=t.get,a=t.set,i=o(l).filter((function(t){return t.id!==e}));r&&i.push(o(n(e))),a(l,i)}}}),b=i.selector({key:e("allSelected"),get:function(e){var t=e.get,n=t(l).map((function(e){return e.id}));return f.default.every(t(r),(function(e){return n.indexOf(e)>=0}))},set:function(e,t){var r=e.get,n=e.set;n(l,t?f.default.unionWith(r(l),r(o),(function(e,t){return e.id==t.id})):[])}}),O=i.selectorFamily({key:e("itemOrder"),get:function(e){return function(t){var r=(0,t.get)(d);return void 0!==r&&r[e]||""}},set:function(e){return function(t,r){var n=t.set,o=(0,t.get)(d);n(d,A(A({},o),{},F({},e,r)))}}});return{ids:r,item:n,items:o,selected:l,count:a,option:u,optionSelector:c,fields:s,order:d,limit:m,skip:p,wheres:v,where:h,loading:y,itemSelected:g,allSelected:b,itemOrder:O}};function R(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return e.length>n?{done:!1,value:e[n++]}:{done:!0}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);t>r;r++)n[r]=e[r];return n}function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var V=d.default.createContext(null),B=function(){var e=i.useRecoilSnapshot();return d.default.useEffect((function(){if(e){console.debug("[Recoil] state change:");var t,r=R(e.getNodes_UNSTABLE({isModified:!0}));try{for(r.s();!(t=r.n()).done;){var n=t.value;console.debug(n.key,e.getLoadable(n))}}catch(e){r.e(e)}finally{r.f()}}}),[e]),null},q=function(e){var t=e.model,r=e.initialValues,n=e.children,a=o.use("query"),l=d.default.useState(!0),u=L(l,2),c=u[0],s=u[1],m=i.useRecoilCallback((function(e){var n=e.set;return function(){var e=r||{};t.initialValues&&(e=T(T({},f.default.isFunction(t.initialValues)?t.initialValues():t.initialValues),e));var o=e.wheres,i=void 0===o?{}:o,l=k(e,["wheres"]),u={fields:j(t.listFields||[]),order:t.defaultOrder||t.orders||{},limit:t.defaultPageSize||15,skip:0};if(a&&!f.default.isEmpty(a)){var c=Object.keys(a).reduce((function(e,t){return t.startsWith("f_")&&(e[t.substring(2)]=a[t]),e}),{});f.default.isEmpty(c)||(i.param_filter=c)}n(t.atoms.option,T(T({},u),l)),n(t.atoms.wheres,i)}}),[r,t,a]);return d.default.useEffect((function(){m(),s(!1)}),[]),c?null:n},G=function(e){var t=e.name,r=e.schema,n=e.modelKey,a=e.initialValues,l=e.children,u=e.debug,c=e.props,s=d.default.useMemo((function(){var e=t?function(e,t,r){var n=o.app.get("models")[e];if(!n)throw Error("Model '".concat(e,"' not found!"));return n.name=n.name||e,T(T({},n),{},{key:t||n.name},r)}(t,n,c):T(T({},r),{},{key:n||r.name},c),a=[D].concat(j(o.app.get("modelAtoms"))).reduce((function(t,r){return T(T({},t),r((function(t){return"model.".concat(e.key,".").concat(t)}),e))}),{});return T(T({},e),{},{atoms:a})}),[t,r,n]);return s&&d.default.createElement(i.RecoilRoot,{override:!1},(s.debug||u)&&d.default.createElement(B,null),d.default.createElement(V.Provider,{value:s},d.default.createElement(q,{initialValues:a,model:s},l)))},z=function(){var e=o.use("model").model,t=e.components&&e.components.ListPage||r.C("Model.ListPage"),n=e.components&&e.components.DetailPage||r.C("Model.DetailPage"),i=e.components&&e.components.AddPage||r.C("Model.FormPage"),l=e.components&&e.components.EditPage||r.C("Model.FormPage");return d.default.createElement(a.Routes,null,(!e.permission||e.permission.view)&&d.default.createElement(a.Route,{path:"/",element:d.default.createElement(t,null)}),(!e.permission||e.permission.view)&&d.default.createElement(a.Route,{path:"list",element:d.default.createElement(t,null)}),(!e.permission||e.permission.view)&&d.default.createElement(a.Route,{path:":id/detail",element:d.default.createElement(n,null)}),(!e.permission||e.permission.add)&&d.default.createElement(a.Route,{path:"add",element:d.default.createElement(i,null)}),(!e.permission||e.permission.edit)&&d.default.createElement(a.Route,{path:":id/edit",element:d.default.createElement(l,null)}))},K=v(h((function(e){function t(e,t,r,n,o,a,i){try{var l=e[a](i),u=l.value}catch(e){return void r(e)}l.done?t(u):Promise.resolve(u).then(n,o)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(o,a){var i=e.apply(r,n);function l(e){t(i,o,a,l,u,"next",e)}function u(e){t(i,o,a,l,u,"throw",e)}l(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0}))),U=h((function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",i=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var o=Object.create((t&&t.prototype instanceof d?t:d).prototype),a=new j(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(o,a){if("executing"===n)throw Error("Generator is already running");if("completed"===n){if("throw"===o)throw a;return _()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var l=O(i,r);if(l){if(l===s)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var s={};function d(){}function f(){}function m(){}var p={};p[o]=function(){return this};var v=Object.getPrototypeOf,h=v&&v(v(E([])));h&&h!==t&&r.call(h,o)&&(p=h);var y=m.prototype=d.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(o,a){function i(){return new t((function(n,i){!function n(o,a,i,l){var u=c(e[o],e,a);if("throw"!==u.type){var s=u.arg,d=s.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,l)}),(function(e){n("throw",e,i,l)})):t.resolve(d).then((function(e){s.value=e,i(s)}),(function(e){return n("throw",e,i,l)}))}l(u.arg)}(o,a,n,i)}))}return n=n?n.then(i,i):i()}}function O(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,O(e,t),"throw"===t.method))return s;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return s}var n=c(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,s;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,s):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,s)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:_}}function _(){return{value:void 0,done:!0}}return f.prototype=y.constructor=m,m.constructor=f,f.displayName=l(m,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,i,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},g(b.prototype),b.prototype[a]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new b(u(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},g(y),l(y,i,"Generator"),y[o]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=E,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return n("end");if(this.prev>=a.tryLoc){var l=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(l&&u){if(a.catchLoc>this.prev)return n(a.catchLoc,!0);if(a.finallyLoc>this.prev)return n(a.finallyLoc)}else if(l){if(a.catchLoc>this.prev)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(a.finallyLoc>this.prev)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(this.prev>=o.tryLoc&&r.call(o,"finallyLoc")&&o.finallyLoc>this.prev){var a=o;break}}!a||"break"!==e&&"continue"!==e||a.tryLoc>t||t>a.finallyLoc||(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,s):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),s},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),s}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;w(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),Q=function(e,t){return t.split(".").reduce((function(e,t){return e&&e.properties&&e.properties[t]}),e)},W=Object.freeze({__proto__:null,getFieldProp:Q});function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var H=function(e,r){var n=t.useContext(V);if(!n)throw Error("Need Model Context when use model hooks.");var o=e;if(f.default.isFunction(e))o=e(n.atoms);else if(f.default.isString(e)){if(f.default.isNil(o=n.atoms[e]))throw Error("Model atom ".concat(e," undefined."));r&&(o=o(r))}return o},J=function(e,t){return i.useRecoilValue(H(e,t))},X=function(e,t){return i.useRecoilState(H(e,t))},Z=function(e,t){return i.useSetRecoilState(H(e,t))},ee=function(e,t){var r=o.use("model"),n=r.model,a=r.atoms;return i.useRecoilCallback((function(t){return t.atoms=a,e(t)}),[].concat(j(t),[n]))},te={model:function(){var e=t.useContext(V);if(!e)throw Error("Need Model Context when use model hooks.");var r=t.useMemo((function(){return o.api(e)}),[e]);return{model:e,rest:r,atoms:e.atoms}},"model.value":J,"model.setter":Z,"model.state":X,"model.callback":ee,"model.get":function(e){var r=e.id,n=e.query,a=e.item,i=o.use("model"),u=i.model,c=i.rest,s=d.default.useMemo((function(){var e=a;return e||(u.defaultValue&&(e=f.default.isFunction(u.defaultValue)?u.defaultValue():u.defaultValue),f.default.isEmpty(n)||(e=$($({},e),n))),e}),[a,u.defaultValue,n]),m=t.useState((function(){return{data:s,loading:!(s||!r)}})),p=L(m,2),v=p[0],h=p[1];t.useEffect((function(){var e=v.data;r&&(null==e?void 0:e.id)!=r?(h({data:e,loading:!0}),c.get(r).then((function(e){h({data:e,loading:!1})}))):h({data:s,loading:!1})}),[r]);var y=l._t(r?"Edit {{title}}":"Create {{title}}",{title:u.title});return $({model:u,title:y},v)},"model.save":function(e){var t=o.use("model"),r=t.model,n=t.rest,a=o.use("message"),i=null==e?void 0:e.successMessage,u=ee((function(e){var t=e.snapshot,u=e.set,c=e.atoms;return function(){var e=K(U.mark((function e(s,d){var f,m,p,v,h,y,g;return U.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(c.loading("save"),!0),e.prev=1,(r.partialSave||s.__partial__)&&(d=!0),e.next=5,n.save(s,d);case 5:return m=(f=e.sent).id||s.id,p=f||s,d&&(v=t.getLoadable(c.item(m)).contents,p=$($({},v),p)),u(c.item(m),p),h=t.getLoadable(c.selected).contents,u(c.selected,h.map((function(e){return e.id!==m?e:p}))),null!=a&&a.success&&!1!==i&&(y=r.title||r.name,g=i||l._t(null==s.id?"Create {{object}} success":"Save {{object}} success",{object:y}),a.success(g)),e.abrupt("return",f);case 16:throw e.prev=16,e.t0=e.catch(1),o.app.error(e.t0),e.t0.formError||e.t0.json||e.t0;case 20:return e.prev=20,u(c.loading("save"),!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[1,16,20,23]])})));return function(t,r){return e.apply(this,arguments)}}()}),[]);return{model:r,saveItem:u}},"model.delete":function(e){var t=o.use("model"),r=t.model,n=t.rest,a=o.use("model.getItems").getItems,i=o.use("message"),u=null==e?void 0:e.deleteMessage,c=null==e?void 0:e.id,s=ee((function(e){var t=e.snapshot,o=e.set,s=e.atoms;return function(){var e=K(U.mark((function e(d){var f;return U.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=d||c,e.next=3,n.delete(d);case 3:return f=t.getLoadable(s.selected).contents,o(s.selected,f.filter((function(e){return e.id!==d}))),(null==i?void 0:i.success)&&i.success(u||l._t("Delete {{object}} success",{object:r.title||r.name})),e.next=8,a();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),[c]);return{model:r,deleteItem:s}},"model.getItems":function(){var e=o.use("model"),t=e.rest;return{model:e.model,getItems:ee((function(e){var r=e.snapshot,n=e.set,a=e.reset,i=e.atoms;return function(){var e=K(U.mark((function e(l){var u,c,s,d,m,p,v,h;return U.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=(u=l||{}).wheres,s=k(u,["wheres"]),d=c||r.getLoadable(i.wheres).contents,m=$($({},r.getLoadable(i.option).contents),s),n(i.loading("items"),!0),e.prev=4,e.next=7,t.query(m,d);case 7:return h=(p=e.sent).total,n(i.items,v=p.items),n(i.count,h),f.default.isEmpty(s)||n(i.option,m),c&&n(i.wheres,d),e.abrupt("return",{items:v,total:h});case 17:throw e.prev=17,e.t0=e.catch(4),o.app.error(e.t0),a(i.ids),a(i.count),e.t0;case 23:return e.prev=23,n(i.loading("items"),!1),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[4,17,23,26]])})));return function(t){return e.apply(this,arguments)}}()}),[])}},"model.item":function(e){return $($($({},o.use("model.get",e)),o.use("model.save",e)),o.use("model.delete",e))},"model.query":function(){var e=o.use("model"),r=e.model,n=e.rest,a=t.useState(null),i=L(a,2),l=i[0],u=i[1],c=t.useState(!1),s=L(c,2),d=s[0],f=s[1];return t.useEffect((function(){f(!0),n.query().then((function(e){u(e.items),f(!1)}))}),[]),{items:l,loading:d,model:r}},"model.permission":function(){var e=o.use("model").model;return{canAdd:!!e.permission&&!!e.permission.add,canDelete:!!e.permission&&!!e.permission.delete,canEdit:!!e.permission&&!!e.permission.edit}},"model.event":function(){var e=o.use("model").model,t=o.use("navigate");return $({onAdd:function(){return t("../add")},onSaved:function(){return history&&history.length>1&&history.back()||t("../")},onBack:function(){return history&&history.length>1&&history.back()||t(-1)},onEdit:function(e){return t("../".concat(encodeURIComponent(e||props.id),"/edit"))}},e.events)},"model.effect":function(){var e=o.use("model").model,t=o.use("model.getItems").getItems,r=J("option"),n=J("wheres");return d.default.useEffect((function(){!1!==e.initQuery?t():e.initQuery=void 0}),[r,n]),null},"model.pagination":function(){o.use("model.atoms");var e=J("count"),r=J("limit"),n=X("skip"),a=L(n,2),i=a[0],l=a[1];return{items:Math.ceil(e/r),activePage:Math.floor(i/r)+1,changePage:t.useCallback((function(e){l(r*(e-1))}),[l,r])}},"model.count":function(){return{count:J("count")}},"model.pagesize":function(){var e=X("limit"),r=L(e,2),n=r[0],a=r[1],i=Z("skip");return{sizes:o.config("pageSizes",[15,30,50,100]),setPageSize:t.useCallback((function(e){a(e),i(0)}),[a,i]),size:n}},"model.fields":function(){var e=o.use("model").model,r=X("fields"),n=L(r,2),a=n[0],i=n[1],l=t.useCallback((function(t){var r=L(t,2),n=r[0],o=r[1],l=j(a),u=f.default.indexOf(l,n);o?-1===u&&l.push(n):f.default.remove(l,(function(e){return e===n}));var c=Array.from(new Set([].concat(j(e.listFields),j(Object.keys(e.properties)))));i(c.filter((function(e){return l.indexOf(e)>=0})))}),[a,e,i]);return{fields:e.properties,changeFieldDisplay:l,selected:a}},"model.list":function(){o.use("model.effect");var e=J("items"),t=J("selected"),r=J("fields");return{loading:J("loading","items"),items:e,fields:r,selected:t}},"model.actions":function(){var e=o.use("model").model,t=o.app.get("modelActions"),r=void 0===e.itemActions?Object.keys(t).filter((function(e){return t[e].default})):e.itemActions,n=d.default.useCallback((function(e){return r?r.map((function(r,n){var o=f.default.isString(r)&&t[r]?t[r].component:r;return o?d.default.createElement(o,y({key:"model-action-".concat(n)},e)):null})).filter(Boolean):null}),[r]);return{actions:r,renderActions:n}},"model.select":function(){o.use("model");var e=J("selected"),t=X("allSelected"),r=L(t,2),n=r[0],a=r[1],i=ee((function(e){var t=e.set,r=e.atoms;return function(e,n){t(r.itemSelected(e.id),n)}}),[]);return{count:e.length,selected:e,isSelectedAll:n,onSelect:i,onSelectAll:a}},"model.list.row":function(e){var t=e.id,r=o.use("model").model,n=J("item",t),a=X("itemSelected",t),i=L(a,2);return{selected:i[0],item:n,changeSelect:i[1],actions:r.itemActions||["edit","delete"]}},"model.list.header":function(e){var t=e.field,r=o.use("model"),n=Q(r.model,t)||{};return{title:n.header||n.title||f.default.startCase(t)}},"model.list.order":function(e){var t=e.field,r=o.use("model"),n=Q(r.model,t)||{},a=void 0!==n.canOrder?n.canOrder:void 0!==n.orderField||"object"!=n.type&&"array"!=n.type,i=X("itemOrder",n.orderField||t),l=L(i,2);return{changeOrder:l[1],canOrder:a,order:l[0]}},"model.list.item":function(e){var t=e.schema,r=e.field,n=e.item,a=e.nest,i=o.use("model").model,l=t||Q(i,r),u=t?{}:{schema:l},c=t?"".concat(t.name,".").concat(r):r;return null==i.fieldRender&&(i.fieldRender={}),null==i.fieldRender[c]&&(i.fieldRender[c]=null!=l?o.app.get("fieldRenders").reduce((function(e,t){return t(e,l,r)}),null):null),i.fieldRender[c]&&(u.componentClass=i.fieldRender[c]),u.value=f.default.get(n,r),u.editable=1==a||null==i.editableFields||0>i.editableFields.indexOf(r),u}};function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var ne=[function(e,t){if(t.renderTemplate)return function(e){var r=e.value,n=e.wrap,o=k(e,["value","wrap"]),a=f.default.template(t.renderTemplate)(function(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({value:r},o));return d.default.createElement(n,null,d.default.createElement("span",{dangerouslySetInnerHTML:{__html:a}}))};if("string"==t.type&&["time","date","date-time","datetime"].indexOf(t.format)>-1){var n=m.default.load_dict("config").date_format||{},o=t.dateFormat||{time:n.time||"LT",date:n.date||"LL","date-time":n.datetime||"LLL",datetime:n.datetime||"LLL"}[t.format];return function(e){var t=e.value,r=e.wrap;if(f.default.isNil(t))return d.default.createElement(r,null,d.default.createElement("span",{className:"text-muted"},"-"));var n=p.default(t);return d.default.createElement(r,null,n.format(o))}}return"string"==t.type&&t.enum&&t.enum_title?function(e){var r=e.value,n=e.wrap,o=null,a=t.enum.indexOf(r);return o=f.default.isArray(t.enum_title)&&a>-1?t.enum_title[a]:t.enum_title[r],d.default.createElement(n,null,o||r)}:("number"==t.type||"integer"==t.type)&&t.enum&&t.enum_title?function(e){var r=e.value,n=e.wrap,o=null,a=t.enum.indexOf(r);return f.default.isArray(t.enum_title)&&a>-1&&(o=t.enum_title[a]),d.default.createElement(n,null,o||r)}:"boolean"==t.type?function(e){return d.default.createElement(e.wrap,{style:{textAlign:"center"}},d.default.createElement(r.C,{is:"Model.BooleanIcon",value:e.value,schema:t}))}:"array"==t.type?function(e){var n=e.value,o=e.wrap,a="".concat(e.field,"__items"),i=function(e){return d.default.createElement("span",null,e.children,", ")},l=function(e){return d.default.createElement("span",null,e.children)};f.default.isArray(n)||(n=f.default.isString(n)?n.split(","):[n]);var u=n?n.map((function(e,o){return d.default.createElement(r.C,{is:"Model.DataItem",nest:!0,item:F({},a,e),field:a,schema:t.items,wrap:n.length-1>o?i:l})})):null;return d.default.createElement(o,null,u)}:"string"==t.type&&"email"==t.format?function(e){var t=e.value;return d.default.createElement(e.wrap,null,t?d.default.createElement("a",{href:"mailto:".concat(t)},t):"")}:"object"==t.type?function(e){var n=t.display_field||"name";return d.default.createElement(r.C,{is:"Model.DataItem",nest:!0,item:e.value,field:n,schema:t.properties[n],wrap:e.wrap})}:e}];function oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ae(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ie=[function(e,t,r){if("array"==t.type&&"object"==t.items.type&&t.items.relateTo){var n=m.default.get("models"),o=t.items.relateTo;if(n[o]){var a=n[o];e.type="multi_select",e.schema=a,e.displayField=a.displayField||"name"}}return e},function(e,t,r){if("object"==t.type&&t.relateTo){var n=m.default.get("models"),o=t.relateTo;if(n[o]){var a=n[o];e.type="fkselect",e.schema=a,e.displayField=a.displayField||"name"}}return e}],le=[function(e,t,r){if("object"==t.type&&t.relateTo){var n=m.default.get("models"),o=t.relateTo;if(n[o]){var a=n[o];e.type="filter_relate",e.schema=a,e.displayField=a.displayField||"name"}}return e}],ue=d.default.createContext(),ce=function(e){var t=e.id,n=e.children,a=o.use("model").model,i=o.use("model.get",{id:t}),l=i.data;return i.loading||null==l?d.default.createElement(r.Loading,null):d.default.createElement(r.C,{is:"Relate.Container",model:a,data:l},d.default.createElement(ue.Provider,{value:{item:l,model:a}},n))},se=function(e,t){return function(r){var n=r.location,o=k(r,["location"]),a=d.default.useContext(ue),i=a.item,l=a.model;return d.default.createElement(e,y({},o,{location:ae(ae({},n),{},{query:ae(ae({},n.query),{},F({},t||l.name,i.id))})}))}},de={name:"xadmin.model.relate",schema_converter:ie,filter_converter:le,routers:function(e){for(var t=e.get("models"),n=e.context._t,o=Object.keys(t),a={},i=function(){var e=u[l],i=t[e],c=i.title||i.name;a["/app/model/".concat(e,"/")]={path:":id/relations/",breadcrumbName:n("{{name}} List",{name:c}),component:function(e){return d.default.createElement(ce,{id:e.params.id},e.children)}};for(var s=0,f=Object.keys(i.properties||{});f.length>s;s++){var m=f[s],p=i.properties[m];"object"==p.type&&p.relateTo&&o.indexOf(p.relateTo)>-1&&function(){var t=p.relateTo,o=[];i.permission&&!i.permission.view||o.push({path:"list",breadcrumbName:n("{{name}} List",{name:c}),component:se(i.components&&(i.components.RelateListPage||i.components.ListPage)||r.C("Relate.ListPage")||r.C("Model.ListPage"),m)}),i.permission&&i.permission.add&&o.push({path:"add",breadcrumbName:n("Create {{name}}",{name:c}),component:se(i.components&&(i.components.RelateFormPage||i.components.FormPage)||r.C("Relate.FormPage")||r.C("Model.FormPage"),m)});var l="/app/model/".concat(t,"/:id/relations/");a[l]=[].concat(j(a[l]||[]),[{path:"".concat(e,"/"),breadcrumbName:n("{{name}} List",{name:c}),component:function(r){var n=r.children;return d.default.createElement(G,{name:e,modelKey:"".concat(t,"_").concat(e)},n)},indexRoute:{onEnter:function(e,t){return t({pathname:e.location.pathname+"list"})}},childRoutes:o}])}()}},l=0,u=o;u.length>l;l++)i();return a},hooks:{"model.relate.select":function(e){var t=e.field,r=o.use("model").model,n=d.default.useState(!1),a=L(n,2),i=a[0],l=a[1],u=d.default.useState([]),c=L(u,2),s=c[0],f=c[1],m=d.default.useCallback((function(e){var r=t.displayField||"name";return l(!0),o.api(t.schema).query({limit:1e3,fields:["id",r]},e?{search:F({},r,{like:e})}:{}).then((function(e){var t=e.items;l(!1),f(t.map((function(e){return{value:e.id,label:e[r],item:e}})))}))}),[r,t]);return d.default.useEffect((function(){m()}),[]),{loadOptions:m,loading:i,options:s}}}},fe=function(e,t){var r=[];return e.forEach((function(e,n){r.push({name:null!=t&&(f.default.isArray(t)?t[n]:t[e])||e,value:e})})),r},me=[function(e,t,r){var n=e.schema||t;return e.key=r.key||n.name,e.name=e.key,e.label=n.title||e.name,n.description&&(e.description=n.description),n.maxLength&&(e.maxlength=n.maxLength),n.minLength&&(e.minlength=n.minLength),n.minimum&&(e.minimum=n.minimum+(n.exclusiveMinimum?1:0)),n.maximum&&(e.maximum=n.maximum-(n.exclusiveMaximum?1:0)),n.validationMessage&&(e.validationMessage=n.validationMessage),n.enumNames&&(e.titleMap=function(e,t){if(!f.default.isArray(e)){var r=[];if(t)t.forEach((function(t){r.push({name:e[t],value:t})}));else for(var n in e)e.hasOwnProperty(n)&&r.push({name:n,value:e[n]});return r}return e}(n.enumNames,n.enum)),e.schema=n,e},function(e,t,r){if(void 0!==e.type)return e;var n=function(e){if(Array.isArray(e)&&2==e.length){if("null"===e[0])return e[1];if("null"===e[1])return e[0]}return e}(t.type);if("string"===n)switch(t.enum?(e.type="filter_enum",e.titleMap||(e.titleMap=fe(t.enum,t.enum_title||{}))):e.type="filter_text",t.format){case"date":e.type="filter_date";break;case"time":e.type="filter_time";break;case"datetime":case"date-time":e.type="filter_datetime"}else"number"===n||"integer"===n?t.enum?(e.type="filter_enum",e.titleMap||(e.titleMap=fe(t.enum,t.enum_title||{}))):e.type="filter_number":"boolean"===n&&(e.type="filter_bool");return e}];function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var ve=function(e){var t=e.component,r=k(e,["component"]),n=o.use("model.list.filter");return d.default.createElement(t,y({},r,{resetFilter:n.resetFilter}))},he=function(e){var t=e.name,r=e.component,n=e.group,a=e.fieldProps,l=o.use("model"),u=l.model,s=i.useRecoilState(l.atoms.where("filters")),p=L(s,2),v=p[0],h=p[1],g=d.default.useMemo((function(){var e,r,n="filter.".concat(u.key||u.name),o=u.filters&&u.filters[t];if(f.default.isArray(o))r={},e=o;else{if(!f.default.isPlainObject(o)||!f.default.isArray(o.fields))return{filters:[],formKey:n,options:{}};e=o.fields,r=f.default.omit(o,"fields")}return{filters:e.map((function(e){var t="string"==typeof e?e:e.key,r=Q(u,t);return r?{key:t,schema:r,field:"string"==typeof e?{}:e}:null})).filter(Boolean),formKey:n,options:r}}),[u,t]),b=g.filters,O=g.options,x=d.default.useMemo((function(){return b.map((function(e){var t=function(e,t){var r=t||{};return m.default.load_list("filter_converter").reduce((function(t,n){return n(t,e,r)}),{})}(e.schema,{key:e.key});return f.default.merge(t,e.field,a)}))}),[b,a]),w=d.default.useCallback((function(e){var t=Object.keys(e).reduce((function(t,r){return f.default.isNil(e[r])?t=f.default.omit(t,r):t[r]=e[r],t}),function(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},v));h(t)}),[u,v,h]);return x&&b.length?d.default.createElement(c.Form,{onSubmit:w,onChange:O&&1==O.submitOnChange?w:void 0,fields:x,component:function(e){return d.default.createElement(ve,y({},e,{component:r}))},group:n,initialValues:v||{},options:O}):null},ye=function(e,t,n){return function(o){var a=o.model;return a&&a.filters&&a.filters[e]?d.default.createElement(he,{name:e,component:r.C(t),group:n&&r.C(n)}):null}},ge={name:"xadmin.filter",components:{"Model.BaseFilter":he},blocks:{"model.list.nav":ye("navform","Filter.NavForm","Form.InlineGroup"),"model.list.navbtn":ye("nav","Filter.Modal"),"model.list.submenu":ye("submenu","Filter.Submenu","Form.ColGroup"),"model.list.sidemenu":ye("sidemenu","Filter.Form","Form.SimpleGroup")},hooks:{"model.list.filter":function(){var e=o.use("model"),t=e.model,r=e.atoms,n=o.use("form").form,a=i.useSetRecoilState(r.where("filters")),l=d.default.useCallback((function(){var e=f.default.isFunction(t.initialValues)?t.initialValues():t.initialValues,r=e&&e.wheres&&e.wheres.filters||{};n.reset(r),a(r)}),[t,a]);return d.default.useEffect((function(){if(t.filterDefault){var e=f.default.isFunction(t.filterDefault)?t.filterDefault():t.filterDefault;n.reset(e)}}),[t.filterDefault]),{resetFilter:l}}},filter_converter:me};function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Oe(e){for(var t=1;arguments.length>t;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var xe={items:{modelBatchActions:{type:"map"}},modelBatchActions:{edit:{default:!0,component:function(e){var t=e.model;return t.batchChangeFields&&t.permission&&t.permission.edit?d.default.createElement(r.C,y({is:"Model.BatchChange"},e)):null}},delete:{default:!0,component:function(e){var t=e.model;return t.permission&&t.permission.delete?d.default.createElement(r.C,y({is:"Model.BatchDelete"},e)):null}}},hooks:{"model.batchActions":function(){var e=o.use("model").model,t=m.default.get("modelBatchActions"),r=void 0===e.batchActions?Object.keys(t).filter((function(e){return t[e].default})):e.batchActions,n=d.default.useCallback((function(e){return r?r.map((function(r,n){var o=f.default.isString(r)&&t[r]?t[r].component:r;return o?d.default.createElement(o,y({key:"model--batch-action-".concat(n)},e)):null})).filter(Boolean):null}),[r]);return{actions:r,renderActions:n}},"actons.batch_delete":function(e){var t=o.use("model"),r=t.model,n=t.rest,a=t.atoms,u=o.use("model.getItems").getItems,c=o.use("message"),s=o.use("model.permission").canDelete;return{loading:i.useRecoilValue(a.loading("delete_items")),canDelete:s,onBatchDelete:i.useRecoilCallback((function(t){var o=t.snapshot,i=t.set,s=t.reset;return K(U.mark((function t(){var d,p,v;return U.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d=o.getLoadable(a.selected).contents,i(a.loading("delete_items"),!0),t.prev=2,!n.batchSave){t.next=8;break}return t.next=6,n.batchSave(d.map((function(e){return e.id})));case 6:t.next=10;break;case 8:return t.next=10,Promise.all(d.map((function(e){return n.delete(e.id)})));case 10:return s(a.selected),null!=c&&c.success&&!1!==(null==e?void 0:e.successMessage)&&(p=r.title||r.name,v=f.default.isString(null==e?void 0:e.successMessage)?e.successMessage:l._t("Delete {{object}} success",{object:p}),null==c||c.success(v)),u(),t.abrupt("return",null);case 16:throw t.prev=16,t.t0=t.catch(2),m.default.error(t.t0),t.t0.formError||t.t0.json||t.t0;case 20:return t.prev=20,i(a.loading("delete_items"),!1),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[2,16,20,23]])})))}),[u,r])}},"actons.batch_change":function(e){var t=o.use("model"),r=t.model,n=t.rest,a=t.atoms,u=o.use("model.getItems").getItems,c=o.use("message"),s=o.use("model.permission").canEdit,d=i.useRecoilValue(a.loading("save_items")),p=i.useRecoilCallback((function(t){var o=t.snapshot,i=t.set;return function(){var t=K(U.mark((function t(s){var d,p,v,h;return U.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d=o.getLoadable(a.selected).contents,i(a.loading("save_items"),!0),t.prev=2,!n.batchDelte){t.next=9;break}return t.next=6,n.batchDelte(d,s);case 6:p=t.sent,t.next=12;break;case 9:return t.next=11,Promise.all(d.map((function(e){return n.save(Oe({id:e.id},s),!0)})));case 11:p=t.sent;case 12:return null!=c&&c.success&&!1!==(null==e?void 0:e.successMessage)&&(v=r.title||r.name,h=f.default.isString(null==e?void 0:e.successMessage)?e.successMessage:l._t("Batch Save {{object}} success",{object:v}),null==c||c.success(h)),f.default.isNil(p)||f.default.isEmpty(p)?u():p.forEach((function(e){return i(a.item(e.id),e)})),t.abrupt("return",p);case 17:throw t.prev=17,t.t0=t.catch(2),m.default.error(t.t0),t.t0.formError||t.t0.json||t.t0;case 21:return t.prev=21,i(a.loading("save_items"),!1),t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[2,17,21,24]])})));return function(e){return t.apply(this,arguments)}}()}),[u,r]);return{loading:d,fields:r.batchChangeFields||[],canEdit:s,onBatchChange:p}}}},we={name:"xadmin.model.search",blocks:{"model.list.nav":function(e){return d.default.createElement(r.C,y({is:"Model.SearchBar",key:"searchBar"},e))}},hooks:{"model.searchbar":function(){var e=d.default.useState(null),t=L(e,2),r=t[0],n=t[1],a=o.use("model.setter","where","searchbar"),i=o.use("model").model;return{searchValue:r,searchFields:i.searchFields,searchTitles:i.searchFields&&i.searchFields.map((function(e){return i.properties[e].title||e})),onSearch:d.default.useCallback((function(e){if(e){var t=i.searchFields.map((function(t){return F({},t,{like:e})}));t.length>1?a({or:t}):t.length>0&&a(t[0])}else a(null);n(e)}),[i.searchFields,n,a])}}}},je=function(){var e=o.use("model").model,t=o.use("message"),n=o.use("model.permission"),a=n.canAdd,i=n.canEdit,u=o.use("model.save").saveItem,s=o.use("model.getItems").getItems,f=o.use("model.state","modalItem"),m=L(f,2),p=m[0],v=m[1],h=o.use("model.item",{id:p}),g=h.data,b=h.loading,O=d.default.useRef(),x=!_.isNil(p),w=function(){return v(null)};return d.default.useEffect((function(){null!=t&&t.loading&&(b?O.current=null==t?void 0:t.loading(l._t("Loading data")):O.current&&(O.current(),O.current=null))}),[b]),(null==(null==g?void 0:g.id)&&a||null!=(null==g?void 0:g.id)&&i)&&x&&!b?d.default.createElement(c.SchemaForm,y({formKey:"model.modalform.".concat(e.key,".").concat(p),schema:e,initialValues:g,onSubmit:u,onSubmitSuccess:function(e){w(),s()}},e.formProps),(function(t){return d.default.createElement(r.C,y({is:"Form.ModalLayout"},t,{title:e.title,show:x,onClose:w}))})):null},Ee={name:"xadmin.model.modalform",blocks:{"model.list.navbtn":function(){return d.default.createElement(je,null)}},modelAtoms:[function(e){return{modalItem:i.atom({key:e("modalItem"),default:null})}}],hooks:{"model.event":function(){var e=o.use("model.setter","modalItem");return{onAdd:function(){return e("")},onSaved:function(){return e(null)},onEdit:function(t){return e(t)}}}}},_e={name:"xadmin.model.reldetail",field_render:function(e,t){return"object"==t.type&&t.relateTo?function(n){var o=n.value,a=n.wrap;if(o&&void 0!==o.id&&!0===t.showDetail&&Object.keys(m.default.get("models")).indexOf(t.relateTo)>=0){return d.default.createElement(e,{value:o,wrap:function(e){return d.default.createElement(G,{name:t.relateTo},d.default.createElement(a,null,d.default.createElement(r.C,{is:"Model.DetailModal",id:o.id},e.children)))}})}return d.default.createElement(e,{value:o,wrap:a})}:e}},ke={name:"xadmin.model",items:{models:{type:"map"},fieldRenders:{type:"array"},modelActions:{type:"map"},modelAtoms:{type:"array"}},components:{"Model.Routes":z},blocks:function(e){var t=e.get("models");return{"main.menu":function(){return Object.keys(t).map((function(n){var o,a,i,l=t[n];if(null!==(o=l.permission)&&void 0!==o&&o.view&&null!==(a=l.ui)&&void 0!==a&&a.showMenu&&null!==(i=l.ui)&&void 0!==i&&i.menuPath)return d.default.createElement(r.Menu.Item,{itemKey:"main-menu-item-model-".concat(n),onItemClick:function(){return e.go(l.ui.menuPath)},icon:d.default.createElement(r.Icon,{name:l.icon||n})},l.title)})).filter((function(e){return void 0!==e}))}}},routers:function(e){var t=e.get("models"),r=e.context._t,n={"/app/":[{path:"model"}]},o=e.config("autoModelRoutes"),a="/app/model";if(!1===o)return n;f.default.isString(o)&&(a=o);var i=function(e){var o=t[e],i=o.title||o.name;(f.default.isArray(o.route)?o.route:[o.route||{parentPath:a,path:e}]).forEach((function(t){var o=t.parentPath||"/",a=f.default.isString(t)?t:t.path;n[o]||(n[o]=[]),n[o].push({path:"".concat(a,"/*"),breadcrumbName:r("{{name}} List",{name:i}),element:d.default.createElement(G,{key:"model.".concat(o,".").concat(a),name:e},d.default.createElement(z,null))})}))};for(var l in t)i(l);return n},hooks:te,fieldRenders:ne,modelActions:{edit:{default:!0,component:r.C.lazy("Model.ActionEdit")},delete:{default:!0,component:r.C.lazy("Model.ActionDelete")}}},Pe={relate:de,filter:ge,actions:xe,search:we,modalform:Ee,reldetail:_e};e.Model=G,e.ModelBlock=function(e){return d.default.createElement(V.Consumer,null,(function(t){return d.default.createElement(o.Block,y({model:t},e),(function(r){var n=t&&t.blocks&&t.blocks[e.name];if(n){var o=n(e);r=r?[o].concat(j(r)):[o]}return e.children?e.children(r):r}))}))},e.ModelContext=V,e.ModelRoutes=z,e.apps=Pe,e.default=ke,e.utils=W,Object.defineProperty(e,"__esModule",{value:!0})}));
