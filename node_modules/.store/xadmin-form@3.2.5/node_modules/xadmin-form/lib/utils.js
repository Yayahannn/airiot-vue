"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.findFieldByName = findFieldByName;

function findFieldByName(name, fields) {
  function searchFields(name, fields) {
    for (var _field of fields) {
      if (_field.name === name) {
        return _field;
      }
    }

    return null;
  }

  function parsePath(path) {
    var parts = path.split('.');
    var result = [];

    for (var part of parts) {
      if (part.includes('[')) {
        var [key, index] = part.split('[');
        index = parseInt(index.replace(']', ''));
        result.push({
          key,
          index,
          prefixs: [...result]
        });
      } else {
        result.push({
          key: part,
          index: null,
          prefixs: [...result]
        });
      }
    }

    return result;
  }

  var pathParts = parsePath(name);
  var currentFields = fields;
  var field;

  for (var {
    key,
    index,
    prefixs
  } of pathParts) {
    var trueKey = [key];

    for (var _index = prefixs.length - 1; _index >= 0; _index--) {
      var p = prefixs[_index];

      if (p && p.index == null && p.key) {
        trueKey = [p.key, ...trueKey];
      } else {
        break;
      }
    }

    field = searchFields(trueKey.join('.'), currentFields);

    if (field) {
      if (index !== null && field.items && field.items.fields) {
        currentFields = field.items.fields;
        field = currentFields[index];
      } else if (index !== null && field.fields) {
        currentFields = field.fields;
        field = currentFields[index];
      } else {
        currentFields = field.fields || [];
      }
    } else {
      return null;
    }
  }

  return field;
}