!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("react-dom"),require("react-redux"),require("lodash"),require("react-router"),require("redux"),require("redux-saga")):"function"==typeof define&&define.amd?define(["exports","react","react-dom","react-redux","lodash","react-router","redux","redux-saga"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).xadmin={},t.React,t.ReactDOM,t.ReactRedux,t._,t.ReactRouter,t.Redux,t.ReduxSaga)}(this,(function(t,e,n,r,u,o,a,i){"use strict";function c(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var f=c(e),l=c(n),s=c(u),d=c(i);function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function y(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function m(){return(m=Object.assign||function(t){for(var e=1;arguments.length>e;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function g(t){for(var e=1;arguments.length>e;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){v(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t,e){return(O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function w(t,e){if(null==t)return{};var n,r,u=function(t,e){if(null==t)return{};var n,r,u={},o=Object.keys(t);for(r=0;o.length>r;r++)0>e.indexOf(n=o[r])&&(u[n]=t[n]);return u}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;o.length>r;r++)0>e.indexOf(n=o[r])&&Object.prototype.propertyIsEnumerable.call(t,n)&&(u[n]=t[n])}return u}function x(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=_(t);if(e){var u=_(this).constructor;n=Reflect.construct(r,arguments,u)}else n=r.apply(this,arguments);return x(this,n)}}function P(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,u=!1,o=void 0;try{for(var a,i=t[Symbol.iterator]();!(r=(a=i.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){u=!0,o=t}finally{try{r||null==i.return||i.return()}finally{if(u)throw o}}return n}(t,e)||E(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(t){return function(t){if(Array.isArray(t))return A(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||E(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(t,e){if(t){if("string"==typeof t)return A(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(t,e):void 0}}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);e>n;n++)r[n]=t[n];return r}function S(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function M(t,e){return t(e={exports:{}},e.exports),e.exports}var R=Array.isArray;var C=function(){},I=M((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){if(null!==t){var e=t;t=null,e.apply(this,arguments)}}},t.exports=e.default}));S(I);var T=M((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){for(var n=Math.max(t.length-(e|=0),0),r=Array(n),u=0;n>u;u++)r[u]=t[e+u];return r},t.exports=e.default}));S(T);var D=M((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){if(null===t)throw Error("Callback was already called.");var e=t;t=null,e.apply(this,arguments)}},t.exports=e.default}));S(D);var N=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},q=M((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){var e=(0,r.default)(arguments),n=e.pop();t.call(this,e,n)}};var n,r=(n=T)&&n.__esModule?n:{default:n};t.exports=e.default}));S(q);var B=M((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.hasNextTick=e.hasSetImmediate=void 0,e.fallback=i,e.wrap=c;var n,r=(n=T)&&n.__esModule?n:{default:n};var u,o=e.hasSetImmediate="function"==typeof setImmediate&&setImmediate,a=e.hasNextTick="object"==typeof process&&"function"==typeof process.nextTick;function i(t){setTimeout(t,0)}function c(t){return function(e){var n=(0,r.default)(arguments,1);t((function(){e.apply(null,n)}))}}u=o?setImmediate:a?process.nextTick:i,e.default=c(u)}));S(B);var F=M((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,r.default)((function(e,r){var u;try{u=t.apply(this,e)}catch(t){return r(t)}(0,n.default)(u)&&"function"==typeof u.then?u.then((function(t){a(r,null,t)}),(function(t){a(r,t.message?t:Error(t))})):r(null,u)}))};var n=o(N),r=o(q),u=o(B);function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n){try{t(e,n)}catch(t){(0,u.default)(i,t)}}function i(t){throw t}t.exports=e.default}));S(F);var U=M((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.isAsync=void 0;var n,r=(n=F)&&n.__esModule?n:{default:n};var u="function"==typeof Symbol;function o(t){return u&&"AsyncFunction"===t[Symbol.toStringTag]}e.default=function(t){return o(t)?(0,r.default)(t):t},e.isAsync=o}));S(U);var V=S(M((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){if(e=(0,u.default)(e||r.default),!(0,n.default)(t))return e(Error("First argument to waterfall must be an array of functions"));if(!t.length)return e();var c=0;function f(e){var n=(0,i.default)(t[c++]);e.push((0,a.default)(l)),n.apply(null,e)}function l(n){if(n||c===t.length)return e.apply(null,arguments);f((0,o.default)(arguments,1))}f([])};var n=c(R),r=c(C),u=c(I),o=c(T),a=c(D),i=c(U);function c(t){return t&&t.__esModule?t:{default:t}}t.exports=e.default}))),H=function(){function t(){p(this,t),this.apps=[],this.items={},this.context={},this._cache={},this.started=!1}return y(t,[{key:"checkAddItems",value:function(t){var e=this;t&&Object.keys(t).forEach((function(n){if(null!=e.items[n])throw Error("Repeatedly defined configuration item '".concat(n,"'"));e.items[n]=t[n]}))}},{key:"use",value:function(t){var e=t.app||t;return e&&(this.checkAddItems(e.items),this.apps.push(e)),this}},{key:"unuse",value:function(t){var e=this;return this.apps=this.apps.reduce((function(n,r){return r.name!=t?n.push(r):r.items&&Object.keys(r.items).forEach((function(t){return delete e.items[t]})),n}),[]),this}},{key:"items",value:function(){}},{key:"getItem",value:function(t){var e=this.items[t];if(null==e)throw Error("Not defined configuration item '".concat(t,"'"));return e}},{key:"$",value:function(t){return this.get(t)}},{key:"get",value:function(t){var e=this.getItem(t);if(e.reducer&&e.init)return this.reduce(t,e.reducer,e.init);switch(e.type){case"array":return this.array(t);case"mapArray":return this.mapArray(t);case"map":default:return this.map(t)}}},{key:"getValue",value:function(t){return"function"==typeof t&&1==t.length?t(this):t}},{key:"reduce",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.started)throw Error("App not started, can't use app item.");return null==this._cache[t]&&(this._cache[t]=this.apps.reduce((function(n,r){return void 0!==r[t]?e(n,r[t]):n}),n)||n),this._cache[t]}},{key:"map",value:function(t){var e=this;return this.reduce(t,(function(t,n){return g(g({},t),e.getValue(n))}),{})}},{key:"array",value:function(t){var e=this;return this.reduce(t,(function(t,n){return t.concat(e.getValue(n))}),[])}},{key:"mapArray",value:function(t){var e=this;return this.reduce(t,(function(t,n){var r=e.getValue(n);for(var u in r){t[u]=t[u]||[];var o=r[u];Array.isArray(o)?t[u]=t[u].concat(o):t[u].push(o)}return t}),{})}},{key:"load_dict",value:function(t){return this.map(t)}},{key:"load_list",value:function(t){return this.array(t)}},{key:"load_dict_list",value:function(t){return this.mapArray(t)}},{key:"config",value:function(t){return this.get("config")[t]}},{key:"start",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this;this.started=!0,V([function(e){e(null,t)}].concat(j(this.get("context").map((function(t){return function(n,r){return t(n,(function(t,n){e.context=n,r(t,n)}))}})))),(function(t,n){e.context=n,e.get("start").forEach((function(t){t(e)}))}))}},{key:"log",value:function(t,e,n){this.get("logger").forEach((function(r){return r(t,e,n)}))}},{key:"error",value:function(t){this.log("error",""+t,t)}}]),t}(),W={items:{reducers:{type:"mapArray"},"redux/subscribe":{type:"array"},"redux/on_create":{type:"array"},"redux/middlewares":{type:"array"},"redux/store_enhancers":{type:"array"},"redux/reducer_enhance":{type:"mapArray"}},context:function(t){return function(e,n){var r=[a.applyMiddleware.apply(void 0,j(t.get("redux/middlewares")))].concat(j(t.$("redux/store_enhancers"))),u=function(t,e){return e.length>1?function(t,n){return e.reduce((function(t,e){return e(t,n)}),t)}:e[0]},o=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||a.compose,i=a.createStore(function(){var e=t.get("reducers"),n={};for(var r in e)n[r]=u(0,e[r]);return a.combineReducers(n)}(),e.initial_state||{},o.apply(void 0,j(r)));n(null,g(g({},e),{},{store:i}))}},start:function(t){return function(){var e,n=t.context.store,r=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=E(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,u=function(){};return{s:u,n:function(){return t.length>r?{done:!1,value:t[r++]}:{done:!0}},e:function(t){throw t},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}(t.get("redux/subscribe"));try{for(r.s();!(e=r.n()).done;){n.subscribe(e.value)}}catch(t){r.e(t)}finally{r.f()}t.get("redux/on_create").forEach((function(t){return t(n)}))}}},J=d.default(),$={items:{effects:{type:"array"}},context:function(t){return function(e,n){e.store.runSaga=J.run,t.get("effects").forEach(J.run),n(null,e)}},"redux/middlewares":function(t){return J}},L={items:{routers:{type:"mapArray"},root_component:{type:"array"}},context:function(t){return function(e,n){t.go=function(e){t.context.router.push(e)};var r=t.config("router")||"browser",u="string"==typeof r?{browser:o.browserHistory,hash:o.hashHistory}[r]:r;n(null,g(g({},e),{},{router:u}))}},start:function(t){return function(){var e=t.context.container,n=void 0===e?"#app":e;"string"==typeof n&&(n=document.querySelector(n));var r=t.get("routers"),u=function t(e){return(r[e]||[]).map((function(n){var r=t(("@"==e?"":e)+n.path);return r.length>0?g(g({},n),{},{childRoutes:[].concat(j(n.childRoutes||[]),j(r))}):n}))}("@"),a=t.get("root_component").reduce((function(t,e){return e(t)}),u&&u.length?f.default.createElement(o.Router,{history:t.context.router,routes:u[0]}):f.default.createElement("span",null,"Please config routers or Main component."));l.default.render(a,n)}}},X={root_component:function(t){return function(e){return f.default.createElement(r.Provider,{store:t.context.store},e)}},hooks:function(t){return{redux:function(e,n){var r=t.context.store,u=r.getState,o=r.dispatch,a=r.subscribe;if(n){var i=u(),c=P(f.default.useState(n(i)||{}),2),l=c[0],d=c[1],p=f.default.useRef();p.current=l;var h=function(){var t=n(u());s.default.isEqual(p.current,t)||d(t)};return f.default.useEffect((function(){return a(h)}),[]),g(g({},e),{},{store:r,dispatch:o,state:i},l)}return g(g({},e),{},{store:r,dispatch:o,state:u()})}}}},z=function(){function t(e){p(this,t),this.options=e,this.resource=e.resource||e.name}return y(t,[{key:"getHost",value:function(){return"/"}},{key:"fetch",value:function(t,e){throw"App API not implement!!!"}},{key:"count",value:function(){return this.fetch().then((function(t){return t.length}))}},{key:"query",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.fetch().then((function(e){return{total:e.length,items:e.slice(t.skip||0,(t.skip||0)+parseInt(t.limit||15))}}))}},{key:"get",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.fetch(t)}},{key:"delete",value:function(t){return this.fetch(t,{method:"DELETE"})}},{key:"put",value:function(t,e){return this.fetch(t,{method:"PUT",body:JSON.stringify(e)}).then((function(t){return g(g({},e),t)}))}},{key:"patch",value:function(t,e){return this.fetch(t,{method:"PATCH",body:JSON.stringify(e)}).then((function(t){return g(g({},e),t)}))}},{key:"post",value:function(t){return this.fetch(null,{method:"POST",body:JSON.stringify(t)}).then((function(e){return g(g({},t),e)}))}},{key:"save",value:function(t,e){if(t.id){var n=t.id;return e?this.patch(n,t):this.put(n,t)}return this.post(t)}}]),t}();function G(t){return t.displayName||t.name||"Component"}var K=function(t,e,n){if(t===e)return!0;if(null==t&&null!=e||null==e&&null!=t||null==t&&null!=e||null==e&&null!=t)return!1;var r=Object.keys(t);if(r.length!==Object.keys(e).length)return!1;for(var u=Object.prototype.hasOwnProperty,o=0;r.length>o;o++)if(!u.call(e,r[o])||r[o]!=n&&t[r[o]]!==e[r[o]])return!1;return!0},Q=function(t,e,n){var r=window.__app__,u=null,o=function(){return null==u&&(u=(void 0!==n?[n]:[]).concat(e&&r.get("mappers")[e]||[])),u},a=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(r,e);var n=k(r);function r(){var t;p(this,r);for(var e=arguments.length,u=Array(e),o=0;e>o;o++)u[o]=arguments[o];return(t=n.call.apply(n,[this].concat(u))).methodProps=null,t.state={},t}return y(r,[{key:"shouldComponentUpdate",value:function(t,e){return!K(this.state,e)||!K(this.props,t,"wrapContext")}},{key:"componentDidUpdate",value:function(){var t=this;o().forEach((function(e){e.event&&e.event.update&&t.runBindMethod(e.event.update,t)}))}},{key:"componentDidMount",value:function(){var t=this;o().forEach((function(e){e.event&&e.event.mount&&t.runBindMethod(e.event.mount,t)}))}},{key:"componentWillUnmount",value:function(){var t=this;o().forEach((function(e){e.event&&e.event.unmount&&t.runBindMethod(e.event.unmount,t)}))}},{key:"runBindMethod",value:function(t,e){var n=this.state,r=n.dataProps,u=n.computeProps;return t(this.props.wrapContext,g(g(g({},this.props),r),u),e)}},{key:"computeMethodProps",value:function(){var t=this.runBindMethod.bind(this);return o().reduce((function(e,n){if(void 0===n.method)return e;var r=n.method,u={},o=function(e){var n=r[e];u[e]=function(){return t(n).apply(void 0,arguments)}};for(var a in r)o(a);return g(g({},e),u)}),{})}},{key:"render",value:function(){var e=this.state,n=e.forwardedRef,r=e.dataProps,u=e.computeProps;return null==this.methodProps&&(this.methodProps=this.computeMethodProps()),f.default.createElement(t,m({ref:n},s.default.omit(this.props,"wrapContext"),r,u,this.methodProps))}}],[{key:"getDerivedStateFromProps",value:function(t,e){var n=function(t){var e=t.wrapContext,n=w(t,["wrapContext"]);return o().reduce((function(t,r){return s.default.isFunction(r.data)?g(g({},t),r.data(e,n,t)):t}),{})}(t);return K(n,e.dataProps)?null:{dataProps:n,computeProps:function(t){var e=t.wrapContext,n=w(t,["wrapContext"]);return o().reduce((function(t,r){return s.default.isFunction(r.compute)?g(g({},t),r.compute(e,n,t)):t}),{})}(g(g({},t),n))}}}]),r}(f.default.Component);return f.default.forwardRef((function(t,e){return f.default.createElement(a,m({},t,{ref:e}))}))},Y=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return s.default.isFunction(e)?function(n,u){return t(n,u,[e].concat(j(r)))}:function(t){var u=Q(t,s.default.isPlainObject(e)?null:e,s.default.isPlainObject(e)?e:n),o=r.reduce((function(t,e){return e(t)}),u);return o.displayName="Connect(".concat(G(t),")"),o.WrappedComponent=t,o}},Z=Y((function(t){return t})),tt=function(t){var n=t.store,r=t.subscription,u=t.children,o=P(e.useState(n.getState()),2),a=o[0],i=o[1];return e.useEffect((function(){return r.addNestedSub((function(){i(n.getState())}))}),[n,r]),u(a)},et=Y((function(t){return function(e){return f.default.createElement(r.ReactReduxContext.Consumer,null,(function(n){var r=n.store;return f.default.createElement(tt,{store:r,subscription:n.subscription},(function(n){return f.default.createElement(t,m({},e,{wrapContext:{store:r,dispatch:r.dispatch,state:n}}))}))}))}}));null==window.__app__&&(window.__app__=function(t){return t.use(W).use($).use(L).use(X)}((new H).use({items:{config:{type:"map"},context:{type:"array"},start:{type:"array"},logger:{type:"array"},blocks:{type:"mapArray"},mappers:{type:"mapArray"},hooks:{type:"mapArray"}}})));var nt=window.__app__,rt=function(t,e){return nt.get("config")[t]||e};t.Block=function(t){var e=t.children,n=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=window.__app__,r=n.get("blocks");if(void 0!==r[t]){var u=r[t].reduce((function(t,n){var r=n(g({nodes:t},e));return null!=r&&null!=r&&r!=t&&(Array.isArray(r)?t=t.concat(r.map((function(t){return f.default.cloneElement(t,e)}))):f.default.isValidElement(r)&&t.push(f.default.cloneElement(r,e))),t}),[]);if(u.length&&u.filter((function(t){return null!==t})).length>0)return u}return null}(t.name,w(t,["name","children"]));return s.default.isFunction(e)?e(n?f.default.Children.toArray(n):null):f.default.Children.toArray(n)},t.RESTBaseAPI=z,t.StoreWrap=et,t.Wrap=Z,t.api=function(t){var e=rt("api");if(e)return new e(t);throw"App API not implement!!!"},t.app=nt,t.config=rt,t.default=nt,t.use=function(t,e,n){var r=nt.get("hooks")[t];return"function"==typeof e&&null==n&&(n=e,e={}),r?r.reduce((function(t,e){return e(t,n)}),e||{}):e||{}},t.wrap=Y,Object.defineProperty(t,"__esModule",{value:!0})}));
